\documentclass [11pt]{article}						
\usepackage{fancyhdr}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{gensymb}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage[table]{xcolor}
\usepackage{siunitx}
\usepackage{indentfirst}
\usepackage[margin=2.5cm]{geometry}
\usepackage{float}
\usepackage{hyperref}
\usepackage[UKenglish]{datetime}
\usepackage{setspace}
\usepackage{hhline}
\usepackage{lastpage}
\usepackage[numbers]{natbib}
\usepackage[acronym]{glossaries}
\usepackage{listings}
\usepackage{color}

\definecolor{customgreen}{rgb}{0,0.6,0}
\definecolor{customgray}{rgb}{0.5,0.5,0.5}
\definecolor{custommauve}{rgb}{0.6,0,0.8}

\lstset{ 
  basicstyle=\small,        % the size of the fonts that are used for the code
  breaklines=true,                 % sets automatic line breaking
  commentstyle=\color{customgreen},    % comment style
  firstnumber=1,                % start line enumeration with line 1000
  frame=single,	                   % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
  numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
  numbersep=10pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{customgray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stepnumber=1,                    % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{custommauve},     % string literal style
  tabsize=2,	                   % sets default tabsize to 2 spaces
  title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
}

\renewcommand*{\lstlistingname}{Code}
\renewcommand{\lstlistlistingname}{Code}


\makeglossaries

\graphicspath{{images/}}

\hypersetup
{
    colorlinks=true,
    linkcolor=black,   
    urlcolor=blue,
}

\pagestyle{fancyplain}
\fancyhf{}
\fancyhead[R]{Student No. 10618407}
\fancyfoot[R]{\thepage}

\doublespacing

\begin{document}

\newacronym{arm}{ARM}{Advanced RISC Machines Ltd}
\newacronym{orca}{ORCA}{On-water Rubbish Collection robot with Automated sensing}
\newacronym{rf}{RF}{Radio Frequency}
\newacronym{smt}{SMT}{Surface Mount Technology}
\newacronym{tht}{THT}{Through Hole Technology}
\newacronym{rtos}{RTOS}{Real Time Operating System}
\newacronym{bldcm}{BLDCM}{Brushless DC Motor}
\newacronym{dc}{DC}{Direct Current}
\newacronym{pcb}{PCB}{Printed Circuit Board}
\newacronym{ide}{IDE}{Integrated Development Environment}
\newacronym{rc}{RC}{Radio Controlled}
\newacronym{spi}{SPI}{Serial Parallel Interface}
\newacronym{irq}{IRQ}{Interrupt Request}
\newacronym{esc}{ESC}{Electronic Speed Controller}
\newacronym{pwm}{PWM}{Pulse Width Modulation}
\newacronym{li-po}{Li-Po}{Lithium Polymer}
\newacronym{li-ion}{Li-Ion}{Lithium Ion} 
\newacronym{mcu}{MCU}{Microcontroller Unit}
\newacronym{api}{API}{Application Programming Interface}

							
\title{\bf PROJ324 - Project O.R.C.A. - On-water Rubbish Collection robot with Automatic sensing} 	
\author{Luke Waller} 								
\date{\today} 										
\maketitle
\thispagestyle{empty}


\newpage 	

\section*{Abstract}
\pagenumbering{roman}

Oceans make up over 70\% of the worlds surface. They are vital to all life on the planet as a large majority of the oxygen on the planet comes from phytoplankton that live near the surface of the water. It is estimated that over 10 million tonnes of litter end up in the ocean each year. It is estimated that by 2050 the amount of plastic in the ocean will outnumber the fish, with about 15\% floating on the surface (1.5 million tonnes). This on-surface that is being targeted by the On-water Rubbish Collection robot with Automated sensing (O.R.C.A). 
Several solutions to this problem have been created; however, the O.R.C.A based solution aims at a novel application that has previously been left unexplored. O.R.C.A aims to collect rubbish from within in-land bodies of water, plastic chokeholds, using a conveyor-based system to remove the rubbish from the water. 

\section*{Keywords} 
Waste Collection, Microcontroller, Conveyor belt, C++

\newpage
\section*{Acknowledgements}

The author would like to thank the mentor support provided by Dr Ian Howard, who agreed to to undertake the role of mentor during the start of the Autumn Term.

The author would also like to acknowledge the financial support provided by the University of Plymouth. 

The author would also like to thank his family members for their continued support, and his friends for the continued inspiration to push me more and more every year.


		
\newpage			
\fancyfoot[R]{Page \thepage \hspace{1pt} of \pageref{LastPage}}
\setcounter{page}{1}
\pagenumbering{arabic}								
\tableofcontents 
\newpage

\listoffigures
\listoftables
\lstlistoflistings
\printglossaries

\newpage
\section{Introduction}



\section{Design Requirements}

The design requirements for this project as outlined in Appendix \ref{app:design_requirements_hardware} and Appendix \ref{app:design_requirements_software} were agreed upon by {SOMEONE - NOT SURE HOW TO PHRASE IAN AND ME}. The table acts a checklist for the project to ensure that the met all of these requirements, this was a dynamic list that was adapted and amended as the project progressed. The core requirements of the project remained the same but some of the higher level attainable aims were adapted as the project progressed. 

\section{Aims and Objectives}

The aims and objectives, which have been listed below, are used as an indicator of success of the project. These were created using the design requirements of the project. The overall success of this project was measured against these aims and objectives. 

1.	Design and create a boat that is capable of floating on water and being driven around by a radio controller and receiver. The craft will need to be an appropriate size such that it can carry all the equipment on board as well as a decent payload of rubbish to be collected. I will need to create a suitable propulsion system, steering system, and make sure the craft is stable both at top speed and when cornering. It is important to make sure the craft is highly controllable and safe to operate. 

2.	Design and create a suitable litter collection system that can collect litter on the surface of water. The system will need to be able to be turned off, not be damaging to wildlife, and be able to collect all types of litter that collect on the surface. 

3.	Combine the litter collection system with the main hull of the boat. Check that the functionality of both components is not impeded by the combination of the two parts together. Get the two parts of the boat controlled separately using a radio controller (as the radio controller that I have is only 3 channels).

4.	Implement a custom microcontroller based remote control and receiver for the boat that would allow broader uses for the controller. The controller would be able to display some rudimentary values such as, battery charge on the boat, the current capacity of the rubbish collection system, and the status of the litter collection system (operating/not operating).

5.	Add sensors, both active and passive to test for current capacity of the litter collection basket as well as current battery charge. The status would be these combined sensors would be outputted to the controller that would alert the user, alongside stopping the boat when the power is low or when the litter collection basket is full.  

\section{Project Managment}

The project has had a development lifecycle of approximately 36 weeks and began on the 6\^th September 2021. 

The project was split into three phases of development, phase one was research and development of the project and ideas. Phase two was developing prototypes and testing. The final phase, phase three, was finalising the design and build. 

The project was managed using the following software: 

\begin{itemize}

\item{LaTeX (TeXMaker), to write the documentation for the project.}
\item{GitHub, for version control across the whole project.}
\item{Microsoft Excel, to produce Gantt chart and to produce graphs.}
\item{Microsoft OneNote, to log progress and documentation of research and experimentation.}

\end{itemize}

The management style for this project followed a similar style used by Roke Manor Research Ltds. agile framework. This framework follows and agile approach to project development \cite{agile_development}, which is evident in the adaptability of the project as it has developed. 

The utilised style used to manage the project was extremely effective and when utilised with software packages above, all tasks were executed in an organised manner. For general awareness of time management and deadlines, a Gantt chart was utilised. This worked well for this type of project, a solo project undertaken with the supervision of one party, but would not have scaled well to a project with a larger group and organisational supervision. Due to this utilisation method, setbacks were minimised and able to be accounted for within the initial plan. Any unplanned setbacks were easy to coordinate within such a small working group. 

The milestones laid out in the project Gantt Chart for phases 1, 2, and 3 are listed below in Appendix \ref{app:phase_1}, Appendix \ref{app:phase_2}, and Appendix \ref{app:phase_3} respectively.

\subsection{Phase 1 - Autumn Term 2021/22}

Phase 1 of the project was ensuring that the planning, research, and development was conducted in aline with the agile methodology. The objectives from Phase 1 are outlined in Appendix \ref{app:phase_1}. At this stage, The design requirements and optioneering were considered.  

From this initial planning phase, a design brief, Gantt Chart, and future steps were created and agreed upon with the project supervisior. A clear set of requirements had been established along with identification of rudimentary concept ideas. The resultant concepts and decision making processes (optioneering) are detailed in section \ref{sec:research} and section \ref{sec:optioneering}.  

\subsection{Phase 2 - Winter Term 2021/22}

Phase 2 involved undertaking initial prototyping and light development of the work to further the work conducted at the end of Phase 1 and to supplement the work being conducted within Phase 3. Phase 2 ran alongside three full-time university modules. It was used as a basis for the prototyping for the project. During Phase 2, initial designs were created, tested, and evaluated. 

The second phase helped focus the design requirements for the project, whilst evaluating what would be possible within the given time scaled budget. The use of threads, learned from ELEC351, along with ..., drove the development of my project from an Arduino based solution to an ARM based solution, as this enabled the use of RTOS functionality. 

The initial prototypes produced in Phases 1 and 2 helped me evaluate critical dimensions and functionalities of the final craft.

\subsection{Phase 3 - Spring/Summer Term 2022} 

\section{Research}

\subsection{Concept Designs - Controller and Receiver}
\subsubsection{Concept 1 - Off the Shelf Solution}
Controller and Receiver concept 1 was to use an off the shelf system for controlling the craft. This system would be reliable, functional, but it would be expensive and not allow for versatility of inputs and outputs that we would be required. 

The lack input/output versatility would inhibit the use of smart features on the craft. This does not address any newer technologies or concepts that would be suited to this style of custom RC craft. 

Therefore it was decided that this concept would be used for initial testing and as contingency plan, final deployment would be using concept, unless this proved to be impractical. 

\begin{figure}[H]
\centerline{\includegraphics[width=1\textwidth]{Off_Shelf_RC_System}}
\caption{Concept 1 - Off the shelf RC Controller and Receiver}
\label{fig:Custom_RC_System}
\end{figure} 


\subsubsection{Concept 2 - Custom RF Based Solution} \label{sec:concept_2}

Concept 2 introduces "smart" features such as custom battery management circuity and litter collection basket capacity sensing. It allowed for a number of inputs and outputs on each system (up to the limit of the board used to control the systems). This would allow for a highly adaptable control system that could be easily adapted for another use-case. The main craft could be changed and the controller system would be easily reusable. Using a microcontroller based system add the ability to add and remove devices as the requirements of the craft change.

The downsides of the system are... Fiddly AF, Hard to GET RC working, Required Knowledge of Microcontrollers to utilise full functionality.  

\begin{figure}[H]
\centerline{\includegraphics[width=1\textwidth]{Custom_RC_System}}
\caption{Concept 2 - Custom RC Controller and Receiver}
\label{fig:Custom_RC_System}
\end{figure} 

Despite the downsides, this concept had been decided to be the most adaptable and most suited to this application. It is the most complicated of the two concepts; requiring a broad knowledge of embedded systems and battery management technologies. Moreover, the added complexity of the implementation is outweighed by the added functionality and expandability of this system. It was deemed better to design a system that would properly function instead of trying to adapt the correctly available solutions that may not work correct for this purpose.

\section{Optioneering}
\subsection{Controller}

The STM32L432 was selected as the processed used for the controller device for this project. It was decided upon because it was lightweight and powerful enough for it's indented use case. 
 
Cost was also important consideration when selecting suitable prototypes. This weighting was important to make sure that the project budget was used in the most effecitve way possible. Given that the Mbed OS IDE was free to use software the cost of development was not needed to be taken into account. 

The 2 largest competing manufactures within the microcontroller industry, \gls{arm} and AVR were included when making a choice about which proccessor to use. This allowed a full assemenet of the given options to take place. The chosen AVR processor was the ATMega328P, found in the \textit{Arduino Nano}. Given that it was an 8-bit processor it would be expected to perform poorly against the 32-bit \textit{STMicroelectrionics} boards. One advantage of using the the ATMega328P was its ease of use and setup given the large number of libraries avaliable and popularity within the hobbiest community. 

Despite this, the STM chip was chosen, this was primarily due the lack of RTOS functionality on the AVR chip. This would not allow the use of multithreading. The Cortex-L4 chips are lightwieght and do not consumer a lot of power, this would allow the remote to be run for a long time, whilst also enabling features such as RTOS support. 

Another factor in the critical desicion making process was the ongoing silicon shortage and supply chain issues. This reduced the number of avaliable options for use in the controller.  

As a result of the previously mentioned features, the STM32L432 was decided to be the best choice for the controller for use within the controller for Project O.R.C.A.    

\subsection{Receiver}

The STM32F492 was selected for use within the reciever board for this project. This decision making process was conducted in the same manner as the chip selection for the controller. This chip is powerful and includes many inputs and output required to drive the required components for the peripherals.

Power consumption for this board was not an important consideration because it was being powered by the same battery that is used by the motors and other peripherals. The power draw of these components is signicifantly higher than that of the board.

Like with the Controller Optioneering, AVR's ATMega2560 was also considered for use within the reciever. Once again the the RTOS functionality of the STMicroelection  chip paired with the use of the Mbed studio IDE showed the STM32F492 to be the clear choice for chip selection. Given that it was also an ARM processor like the controller, it would be easy to develop the software for as it would only require the use of one IDE. This meant that code would be easy to write for one of the board and be ported easily for reuse on another controller without having to worry about architecture clashes.       

\subsection{Peripherals}
\subsubsection{RF Transciever}

In order to deliver the functionality shown in Concept 2 [\ref{sec:concept_2}] , an RF module would need to be sourced to allow for control of the craft at range. The nRF24L01 is used widley within embedded systems as a long range transciever device. Although a basic device it is highly capable of sending limited amounts of data quickly, such as the use case for RC receivers. The nRF24L01 comes as part of a discreet packge that contains all of the components that require it to operate correctly. The discreet package is shown in Fig \ref{fig:nRF24L01_package}.

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{nRF24L01_package}}
\caption{nRF24L01 Discreet Package}
\label{fig:nRF24L01_package}
\end{figure}

The nRF24L01 package uses an 8 pin interface for communicating using SPI with an added chip enabled pin, IRQ pin, 3.3V and ground. This was the only component in which a pre-written library was used. This library was complicated and worked well. As this was not the main focus of the project it was decided that this libray would be used, as it would not detreact from the project. This library was written in Mbed OS so it did not require porting over from another architecture.  

\subsubsection{Brushless DC Motors}

The motors for propelling the craft were decided to be brushless DC motors (BLDC motors). This type of motor was chosen primarily for its water-resistance, given that it contains no brushes unlike a brushed DC motor \cite{brushed_vs_brushless}. BLDC motors are entirely subermergable as they do not have any exposed contacts and are wound using enamelled copper wire. For this project the A2212 1400KV BLDS motors were selected. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{a2212_1400KV_BLDCM}}
\caption{A2212 1400KV Brushless DC Motor}
\label{fig:a2212_1400KV_BLDCM}
\end{figure}

The A2212 motors were chosen for this project because of their small size, ease of avaliabilty, and their power output. These motors are capable of 'emptying a sink of water in under nine seconds', so they were deemed to be more than powerful enough for this project, if paired with the correct propeller. 

\subsubsection{Conveyor Motors}

For the conveyor belt motors, there were two inital choices for motors, either stepper motors, or a brushed motor with an attached gearbox. These two types of motor were the obvious choice for driving a low speed high torque conveyor belt. The brushed DC motors were chosen to drive the conveyor belt for two main reasons, cost and easibilty of control. Brushed DC motors can be highly geared to have high torque and do not require any specialised motor controller to drive them, unlike stepper motors.

INSERT FIGURE HERE, TAKE PHOTO OF MOTOR
%\begin{figure}[H]
%\centerline{\includegraphics[width=.4\textwidth]{a2212_1400KV_BLDCM}}
%\caption{A2212 1400KV Brushless DC Motor}
%\label{fig:a2212_1400KV_BLDCM}
%\end{figure}

The motors for the conveyor were decided on being  the Dunkermotoren PLG24 DC motor with an attached gearbox with a large reduction. These had an approximate torque of 40Ncm with a gearbox reduction of 353:1. These motors are designed to run at up to 30V. These would lead to the motors being underpowered for this application but as speed was not the defining factor this was not an issue. The only issue with using brushed motors is that they are not waterpoof. This would require a waterproof cowling to cover the motor to ensure that it didn't get damaged by the water. 

\subsubsection{Motor Drivers}


Both the Brushless and Brushed DC motors for this project would require motor drivers to allow the microcontroller reciever to control the motors correctly. Each type of motor requires a different type of motor driver. To drive the BLDC motors, the included 30A 2-3S ESCs were used. These were generic no-name ESC but worked well for the motors and allowed effective control required for this project. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{30A_ESC}}
\caption{Generic no-name 30A ESC}
\label{fig:30A_ESC}
\end{figure}

Unfortunatley, these ESCs did not allow reversal of the motors, this meant an additional method of reversing the craft would be required. The easist solution would be to use two additional motors with revesrsed propellors to drive backwards.

The brushed DC motors are significantly easier to control, requiring a basic DC current to be put across them, as opposed to a complex 3-phase AC current. This mean that just connecting them across the battery would have sufficied to drive these motors forwards. As more control that just on/off was preferable, a motor driver chip would be required to control the movement of these motors. For this, an L298N driver board was chosen. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{L298N_driver}}
\caption{L298N Driver Board for DC and Stepper Motors}
\label{fig:L298N_driver}
\end{figure}

The L298N board is able to drive DC motors, reverse their direction, as well as using a PWM signal to control the speed of the motor. These were all prefered features to allow the best control over the conveyor possible. 

\subsubsection{Batteries}

Batteries are one of the most important components for a remote project as they are required to power the entire craft. There also needs to be batteries for the controller, to allow for portability. For the controller Li-Ion batteries, specifcally 18650s, were decided upon as they offered good amount of energy storage within a small enough package to fit in the controller. These batteres are widley used and are readily avaliable. They have a capacity of 2200mAh at 3.7V. Two would need to be placed in series to get the required voltage for the circuit to reliably operate. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{18650_batteries}}
\caption{18650 Li-Ion Batteries}
\label{fig:18650_batteries}
\end{figure}

The ideal batteries for use within the main craft would have been Li-Po batteries but unfortunatley due to restrictions within the electronincs laboritoriy in SMB303, Li-Po batteries are no allowed to be used for their unstability and fire risk. Because of this, Li-Ion batteries were chosen as a replacement, these were chosen as the next best option for their weight to capacity ratio. Being a prototype the batteries in this craft did not need to be an optimal capcaity. The batteries only needed to last just about long enough to prove the concept and be able to perform testing for the proof of concept. With these considerations in mind, a battery from a robotic vaccuum cleaner was chosen. This battery was 14.4V and 5200mAh. This would provide appromiatley 30 minutes of testing with all features for the craft enabled. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{battery_pack}}
\caption{14.4V 5200mAh Robotic Vaccuum Cleaner Battery Pack}
\label{fig:battery_pack}
\end{figure}

Upon basic inspection the battery pack was made up of two parallel sets of four in series 18650 Li-Ion batteries, the same type of batteries used to power the controller. These batteries are easy to charge and have a higher energy density than Lead acid batteries typically used in car batteries. 

\subsubsection{IR Distance Sensors}

Selecting a suitable IR sensor was relatively simplistic as they all function in the same way, and have similar advantages and disadvantages. As a result of this, a generic no-name IR distance sensor was used. These were inexpensive and functioned in the exact way speicified. The range was adjustable using the small potentiometer on the device. The detection distance was specified to be between 6-30cm, which allowed for ample adjustment to get the right distance. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{ir_sensor}}
\caption{Generic no-name IR Distance Sensor}
\label{fig:ir_sensor}
\end{figure}

IR distnace sensors were selected as they were simplistic, cheap and required no further circuitry to drive them, meaning they could just be dropped into the schematic without too many operational concerns. 

\subsubsection{Voltage Regulators}

Given that many components in this project would need to be powered by the same power input, voltage regulators were used. A 12V, 5V, and 3V were need to get all the required input volages for the various components. As the battery voltage fluctuates with varying levels, the linear voltage regulators continue to output the same voltage. This means the components will not be affected by these varying voltages and work reliability.

\subsection{Finalised Solution}

\subsubsection{Block Diagram}

The final system level block diagram shown in Figure \ref{fig:finalised_block_diagram} is the diagram that was decided upon after component sourcing and critial function anaylisis of the system. The diagram contains the elements proposed in Concept 2 show in §\ref{sec:concept_2}, with the addition of battery monitoring circuitry for low voltage detection. A table summarising the block diagram is listed below in Table \ref{table:component_selection}.

\begin{table}[H]
\centering
\setlength{\arrayrulewidth}{1.5pt}
\begin{tabular}{|p{0.3\linewidth}|p{0.3\linewidth}|}
\hline
\cellcolor{gray!40}Component & \cellcolor{gray!40}Device \\ 
\hline
Controller Microcontroller  & STM32L432KC* \\
\hline
Receiver Microcontroller   & STM32F429ZI\\
\hline
Brushless DC Motors   & A2212 BLDC Motors \\
\hline
BLDC Motor ESC   & Generic no-name 30A ESC\\
\hline
Brushed DC Motor   & Dunkermotoren PLG24 \\
\hline
Brushed DC Motor Driver  & L298N\\
\hline
Controller Batteries   & 18650 Li-Ion Batteries \\
\hline
Buzzer   & Generic no-name buzzer \\
\hline
12V Regulator & 12V Fixed LDO* \\
\hline
5V Regulator & 12V Fixed LDO*\\
\hline
3V Regulator & 12V Fixed LDO*\\
\hline
\multicolumn{2}{l}{\small *selected due to constrains caused by silicon shortage.} \\
\end{tabular}
\caption{Component Selection}
\label{table:component_selection}
\end{table}


{\parindent0pt


Details on how the controller microcontroller's software and hardware was developed and interfaced within the scope of the project can be found in  §\ref{sec:} and §\ref{sec:} respectively.

Details on how the receiver microcontroller's software and hardware was developed and interfaced within the scope of the project can be found in  §\ref{sec:} and §\ref{sec:} respectively.

Details on how the ESCs were interfaced with can be found in §\ref{sec:}.

Details on how the L298N was interfaced with can be found in §\ref{sec:}.

Detailed on how the 12V, 5V, and 3V Regulators were interfaced with can be found in §\ref{sec:}.

}

\begin{figure}[H]
\centerline{\includegraphics[width=1.2 \textwidth, angle = 90]{finalised_block_diagram}}
\caption{Final System Block Diagram of ORCA}
\label{fig:finalised_block_diagram}
\end{figure}


\subsubsection{Bill of Materials}

The bill of materials is listed in Appendix \ref{app:BOM}. Whilst the budget from the University was set at £100, this exceeded that amount. Given that most of the materials for this project had been recycled, the actual budget for the project is less than shown in the bill of materials.

The high cost of this project is due in part to this project being a prototype, and in part to the custom parts that needed to be manufactured for this project. Components are always expected to be more expensive at the prototyping scale of production.

Materials were, for the most part, sourced from responsible VAT registered distributors; which was important when selecting components for mass production. The majority of the components were sourced from Farnell, DigiKey US, CPC, or Ooznest. Some of the other components were sourced from Amazon and eBay. These parts could not be varified to be from a responsible distributor, but these components could have been sourced from other locations if the quantity of the components was larger. 

The fabrication of custom SMD PCBs has been included within the BOM for this project as they were considered to be part of the final prototyped solution. Despite these not being a finalised PCB design for further manufacturing, if applicable, it was a cost that was considered during the prototyping phase of the project. The PCBs were important in the production of this project as they allowed the secure mounting of the RF modules. Given that all of the components needed mounting on a structure that would need to be remotely controlled and manoeuvred, the decision to make PCBs was clear. The PCBs were manufactured in Shenzhen, China but JLC-PCB.

The project was concluded within time scale set but with a slightly expanded budget. Given further time, this project could have been completed closer to the original budget. Due to the expensive nature of some of the components used however, the budget of £100 would likely have not been sufficient for this project without significant cuts to functionality and/or goals.


\section{Software Design}
\subsection{Controller}
\subsubsection{Architecture}


The Controller is entierly multi-threaded. The decision was taken to use  multithreaded architecture due to the nature of the system being used; monitoring and controlling sensors with interupts coming from multiple sources. A single threaded architecture was initially used during inital testing. This was found to be impractical as the statemachine used became cumbersome. When communicating using \gls{rf} the controller could not respond to any other commands from any oher devices. This may not have been quick enough to react to any other inputs from the user. 

Because of this, the controller architecture was split into threads, listed in Table \ref{table:threads_for_controller}. Each entry in the table is represented by a thread in the program that is initialised during start-up. 

\begin{table}[H]
\centering
\setlength{\arrayrulewidth}{1.5pt}
\begin{tabular}{|p{0.3\linewidth}|p{0.3\linewidth}|}
\hline
\cellcolor{gray!40}Thread Name & \cellcolor{gray!40}Function \\ 
\hline
\cellcolor{gray!20}Radio Thread & \cellcolor{gray!20}Sends data over the RF module\\
\hline
\cellcolor{gray!20}Input Thread & \cellcolor{gray!20}Used to handle inputs when flags raised\\
\hline
\end{tabular}
\caption{Threads for Controller}
\label{table:threads_for_controller}
\end{table}

\subsubsection{Serial Communications}\label{sec:serial_communication_1}
The serial communication for this project was done over SPI using nRF24L01 modules to send data. As there was already an nRF24L01 library written for Mbed \cite{nRF24L01_lib_ref}. This abstracted the serial interface from the user to just writing to the \gls{rf} devices, and allowing the library to handle the rest. 

This library was externally written and whilst it was functional, it was a bit rough aroundthe edges and felt, in parts, to be unfinished. Whilst this functionality was not used, it would have been nice to have a complete library. Despite this, the library was operational and only required the data to be sent across using char arrays, whilst fiddly this was not too difficult to achieve. 

This library could have been re-written to include its missing functionality, but this would have taken up a significant amount of the project given that the serial/\gls{rf} communication was not the main objective.     

Despite the class being functionality incomplete, it was easy to use for sending data using radio. Code \ref{code:nRF24L01_declaration} shows how to create the object for the nRF24L01 Class. It requires the use of an \gls{spi} interface on the board.  

\begin{lstlisting}[language=C++,label=code:nRF24L01_declaration,caption=nRF24L01 Class Constructor]
#include <nRF24L01P.h>
nRF24L01P radio(MOSI, MISO, SCK, CSN, CE, IRQ);
\end{lstlisting}

Once the object is declared, the code in Code \ref{code:nRF24L01_SETUP} is then used to set up the nRF24L01 so that it can be used correctly. 

\begin{lstlisting}[language=C++,label=code:nRF24L01_SETUP,caption=nRF24L01 Set Up]
radio.powerUp();
radio.setTransferSize(TRANSFER_SIZE);
radio.setAirDataRate(NRF24L01P_DATARATE_2_MBPS);
radio.setRxAddress(NRF24L01_RX_ADDRESS);
radio.setTxAddress(NRF24L01_TX_ADDRESS);
radio.setReceiveMode();
radio.enable();
\end{lstlisting}

Code \ref{code:nRF24L01_send_data} shows how the data is written to the nRF24L01 module. This requires the data to be in a char array format, ideally the module would allow strings and integers to be passed to it, but the use of char arrays was acceptable.

\begin{lstlisting}[language=C++,label=code:nRF24L01_send_data,caption=Sending Data Using nRF24L01]
radio.write(char *data, int pipe, int count);
\end{lstlisting}



\subsubsection{Buzzer API}

The buzzer used for this project is a standard piezo buzzer that required a PWM pin to drive at a given frequency. To make the buzzer audible and fit within the western standard of music notation, a class was written to to encapsulate the buzzer functionality, allowing the buzzer to be easily used. 

This buzzer class was inspired by the University of Plymouth's buzzer class written for the Module Support Board. 

This class has been written such that it is thread safe. The object-oriented nature of the class has allowed the class and code to be utilised on both the controller and receiver, both of which utilise buzzers as a method of alerting the user. 

\begin{lstlisting}[language=C++,label=code:buzzer_decleration,caption= Buzzer Class Constructor]
#include "Buzzer.h"
Buzzer buzzer(BUZZER);
\end{lstlisting}

Using this \gls{api}, the buzzer could be turned on or off, the note can be changed, and the octave the note is in can also be changed. This allowed multiple different alerts to the user to be utilised. This increased the versatility of the buzzer. 

This class includes operator overloads such that using the buzzer is easy and intuitive.

\subsubsection{Main Code}



\subsection{Receiver}
\subsubsection{Architecture}
\subsubsection{Serial Communications}
\subsubsection{Buzzer API}
\subsubsection{L2938N API}
\subsubsection{BLDCM API}
\subsubsection{Main Code}

\section{Hardware Design}
\section{Testing}
\section{Assembly}
\section{Evaluation}
\section{Further Developments}
\section{Conclusion}

\newpage

\bibliographystyle{IEEEtranN}
\bibliography{refs}

\newpage
\appendix

\section{Design Requirements Table}\label{app:design_requirements_hardware}

\begin{table}[H]
\begin{tabular}{||c||p{0.6\linewidth}|p{0.3\linewidth}||}
\hline
Ref & Requirement                           & Required?             \\
\hline
1   & Main body of the craft                & Yes                   \\
\hline
2   & Suitable Propulsion Method            & Yes                   \\
\hline
3   & Collection System for the litter      & Yes                   \\
\hline
4   & Custom remote controller and receiver & No - highly desirable \\
\hline
5   & Battery powered                       & Yes                   \\
\hline
6   & Suitably Waterproofed                 & Yes\\
\hline              
\end{tabular}
\end{table}

\section{Software Design Requirements Table}\label{app:design_requirements_software}

\begin{table}[H]
\begin{tabular}{||c||p{0.6\linewidth}|p{0.3\linewidth}||}
\hline
Ref & Requirement                                                                                                                                  & Required?         \\ 
\hline
1   & Suitable control system for movement of the craft                                                                                              & Yes               \\
\hline
2   & Suitable control system for collecting litter                                                                                                  & Yes               \\
\hline
3   & Sense when rubbish collection basket is full and alert the user                                                                                & Yes               \\
\hline
4   & Sense when the batteries (on either craft or remote) is running low and alert the user                                                         & Yes               \\
\hline
5   & Suitable communication system between the remote and receiver                                                                                  & Yes               \\
\hline
6   & Relay information from the receiver to the controller about battery voltage and time of current usage, etc.                                    & No - nice to have \\
\hline
7   & System to track amount of rubbish collected                                                                                                    & No - nice to have \\
\hline
8   & Calculations of carbon nuetrality of the collected litter, how much litter would need to be collected to make the craft environmentally viable & No - nice to have \\
\hline
\end{tabular}
\end{table}

\end{document}