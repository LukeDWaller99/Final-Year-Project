\section{Optioneering}
\subsection{Controller Optioneering}

The STM32L432 was selected as the processed used for the controller device for this project. It was decided upon because it was lightweight and powerful enough for it's indented use case. 
 
Cost was also important consideration when selecting suitable prototypes. This weighting was important to make sure that the project budget was used in the most effecitve way possible. Given that the Mbed OS IDE was free to use software the cost of development was not needed to be taken into account. 

The 2 largest competing manufactures within the microcontroller industry, ARM and AVR were included when making a choice about which proccessor to use. This allowed a full assemenet of the given options to take place. The chosen AVR processor was the ATMega328P, found in the \textit{Arduino Nano}. Given that it was an 8-bit processor it would be expected to perform poorly against the 32-bit \textit{STMicroelectrionics} boards. One advantage of using the the ATMega328P was its ease of use and setup given the large number of libraries avaliable and popularity within the hobbiest community. 

Despite this, the STM chip was chosen, this was primarily due the lack of RTOS functionality on the AVR chip. This would not allow the use of multithreading. The Cortex-L4 chips are lightwieght and do not consumer a lot of power, this would allow the remote to be run for a long time, whilst also enabling features such as RTOS support. 

Another factor in the critical desicion making process was the ongoing silicon shortage and supply chain issues. This reduced the number of avaliable options for use in the controller.  

As a result of the previously mentioned features, the STM32L432 was decided to be the best choice for the controller for use within the controller for Project O.R.C.A.    

\subsection{Receiver Optioneering}

The STM32F492 was selected for use within the reciever board for this project. This decision making process was conducted in the same manner as the chip selection for the controller. This chip is powerful and includes many inputs and output required to drive the required components for the peripherals.

Power consumption for this board was not an important consideration because it was being powered by the same battery that is used by the motors and other peripherals. The power draw of these components is signicifantly higher than that of the board.

Like with the Controller Optioneering, AVR's ATMega2560 was also considered for use within the reciever. Once again the the RTOS functionality of the STMicroelection  chip paired with the use of the Mbed studio IDE showed the STM32F492 to be the clear choice for chip selection. Given that it was also an ARM processor like the controller, it would be easy to develop the software for as it would only require the use of one IDE. This meant that code would be easy to write for one of the board and be ported easily for reuse on another controller without having to worry about architecture clashes.       

\subsection{Peripheral Optioneering}
\subsubsection{RF Transciever}

In order to deliver the functionality shown in conecpt (INSERT REF TO CONECPT), an RF module would need to be sourced to allow for control of the craft at range. The nRF24L01 is used widley within embedded systems as a long range transciever device. Although a basic device it is highly capable of sending limited amounts of data quickly, such as the use case for RC receivers. The nRF24L01 comes as part of a discreet packge that contains all of the components that require it to operate correctly. The discreet package is shown in Fig \ref{fig:nRF24L01_package}.

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{nRF24L01_package}}
\caption{nRF24L01 Discreet Package}
\label{fig:nRF24L01_package}
\end{figure}

The nRF24L01 package uses an 8 pin interface for communicating using SPI with an added chip enabled pin, IRQ pin, 3.3V and ground. This was the only component in which a pre-written library was used. This library was complicated and worked well. As this was not the main focus of the project it was decided that this libray would be used, as it would not detreact from the project. This library was written in Mbed OS so it did not require porting over from another architecture.  

\subsubsection{Brushless DC Motors}

The motors for propelling the craft were decided to be brushless DC motors (BLDC motors). This type of motor was chosen primarily for its water-resistance, given that it contains no brushes unlike a brushed DC motor cite{ref:brushed_vs_brushless}. BLDC motors are entirley subermergable as they do not have any exposed contacts and are wound using enamelled copper wire. For this project the A2212 1400KV BLDS motors were selected. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{a2212_1400KV_BLDCM}}
\caption{A2212 1400KV Brushless DC Motor}
\label{fig:a2212_1400KV_BLDCM}
\end{figure}

The A2212 motors were chosen for this project because of their small size, ease of avaliabilty, and their power output. These motors are capable of 'emptiying a sink of water in under nine seconds', so they were deemed to be more than powerful enough for this project, if paired with the correct propellor. Given that this project will not need to be fast moving in the water, the smaller motors were acceptable for usecase. 

\subsubsection{Conveyor Motors}

For the conveyor belt motors, there were two inital choices for motors, either stepper motors, or a brushed motor with an attached gearbox. These two types of motor were the obvious choice for driving a low speed high torque conveyor belt. The brushed DC motors were chosen to drive the conveyor belt for two main reasons, cost and easibilty of control. Brushed DC motors can be highly geared to have high torque and do not require any specialised motor controller to drive them, unlike stepper motors.

INSERT FIGURE HERE, TAKE PHOTO OF MOTOR
%\begin{figure}[H]
%\centerline{\includegraphics[width=.4\textwidth]{a2212_1400KV_BLDCM}}
%\caption{A2212 1400KV Brushless DC Motor}
%\label{fig:a2212_1400KV_BLDCM}
%\end{figure}

The motors for the conveyor were decided on being  the Dunkermotoren PLG24 DC motor with an attached gearbox with a large reduction. These had an approximate torque of 40Ncm with a gearbox reduction of 353:1. These motors are designed to run at up to 30V. These would lead to the motors being underpowered for this application but as speed was not the defining factor this was not an issue. The only issue with using brushed motors is that they are not waterpoof. This would require a waterproof cowling to cover the motor to ensure that it didn't get damaged by the water. 


\subsubsection{Motor Drivers}

Both the Brushless and Brushed DC motors for this project would require motor drivers to allow the microcontroller reciever to control the motors correctly. Each type of motor requires a different type of motor driver. To drive the BLDC motors, the included 30A 2-3S ESCs were used. These were generic no-name ESC but worked well for the motors and allowed effective control required for this project. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{30A_ESC}}
\caption{Generic no-name 30A ESC}
\label{fig:30A_ESC}
\end{figure}

Unfortunatley, these ESCs did not allow reversal of the motors, this meant an additional method of reversing the craft would be required. The easist solution would be to use two additional motors with revesrsed propellors to drive backwards.

The brushed DC motors are significantly easier to control, requiring a basic DC current to be put across them, as opposed to a complex 3-phase AC current. This mean that just connecting them across the battery would have sufficied to drive these motors forwards. As more control that just on/off was preferable, a motor driver chip would be required to control the movement of these motors. For this, an L298N driver board was chosen. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{L298N_driver}}
\caption{L298N Driver Board for DC and Stepper Motors}
\label{fig:L298N_driver}
\end{figure}

The L298N board is able to drive DC motors, reverse their direction, as well as using a PWM signal to control the speed of the motor. These were all prefered features to allow the best control over the conveyor possible. 

\subsubsection{Batteries}


Batteries are one of the most important components for a remote project as they are required to power the entire craft. There also needs to be batteries for the controller, to allow for portability. For the controller Li-Ion batteries, specifcally 18650s, were decided upon as they offered good amount of energy storage within a small enough package to fit in the controller. These batteres are widley used and are readily avaliable. They have a capacity of 2200mAh at 3.7V. Two would need to be placed in series to get the required voltage for the circuit to reliably operate. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{18650_batteries}}
\caption{18650 Li-Ion Batteries}
\label{fig:18650_batteries}
\end{figure}

The ideal batteries for use within the main craft would have been Li-Po batteries but unfortunatley due to restrictions within the electronincs laboritoriy in SMB303, Li-Po batteries are no allowed to be used for their unstability and fire risk. Because of this, Li-Ion batteries were chosen as a replacement, these were chosen as the next best option for their weight to capacity ratio. Being a prototype the batteries in this craft did not need to be an optimal capcaity. The batteries only needed to last just about long enough to prove the concept and be able to perform testing for the proof of concept. With these considerations in mind, a battery from a robotic vaccuum cleaner was chosen. This battery was 14.4V and 5200mAh. This would provide appromiatley 30 minutes of testing with all features for the craft enabled. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{battery_pack}}
\caption{14.4V 5200mAh Robotic Vaccuum Cleaner Battery Pack}
\label{fig:battery_pack}
\end{figure}

Upon basic inspection the battery pack was made up of two parallel sets of four in series 18650 Li-Ion batteries, the same type of batteries used to power the controller. These batteries are easy to charge and have a higher enegry desnity than Lead acid batteries typicaly used in car batteries. 


\subsubsection{IR Distance Sensors}

Selecting a suitable IR sensor was relatively simplistic as they all function in the same way, and have similar advantages and disadvantages. As a result of this, a generic no-name IR distance sensor was used. These were inexpensive and functioned in the exact way speicified. The range was adjustable using the small potentiometer on the device. The detection distance was specified to be between 6-30cm, which allowed for ample adjustment to get the right distance. 

\begin{figure}[H]
\centerline{\includegraphics[width=.4\textwidth]{ir_sensor}}
\caption{Generic no-name IR Distance Sensor}
\label{fig:ir_sensor}
\end{figure}

IR distnace sensors were selected as they were simplistic, cheap and required no further circuitry to drive them, meaning they could just be dropped into the schematic without too many operational concerns. 

\subsubsection{Voltage Regulators}

Given that many components in this project would need to be powered by the same power input, voltage regulators were used. A 12V, 5V, and 3V were need to get all the required input volages for the various components. As the battery voltage fluctuates with varying levels, the linear voltage regulators continue to output the same voltage. This means the components will not be affected by these variying voltages and work reliability.

\subsection{Finalised Solution}

\subsubsection{Block Diagram}

The final system level block diagram shown in Figure \ref{fig:finalised_block_diagram} is the diagram that was decided upon after component sourcing and critial function anaylisis of the system. The diagram contains the elements proposed in Concept 2 show in §\ref{sec:concept_2}, with the addition of battery monitoring circuitry for low voltage detection. A table sumemarising the block diagram is listed below in Table \ref{table:component_selection}.

\begin{table}[H]
\centering
\begin{tabular}{|p{0.3\linewidth}|p{0.3\linewidth}|}
\hline
\cellcolor{blue!25}Component & \cellcolor{blue!25}Device \\ 
\hline
Controller Microcontroller  & STM32L432KC* \\
\hline
Receiver Microcontroller   & STM32F429ZI\\
\hline
Brushless DC Motors   & A2212 BLDC Motors \\
\hline
BLDC Motor ESC   & Generic no-name 30A ESC\\
\hline
Brushed DC Motor   & Dunkermotoren PLG24 \\
\hline
Brushed DC Motor Driver  & L298N\\
\hline
Controller Batteries   & 18650 Li-Ion Batteries \\
\hline
Buzzer   & Generic no-name buzzer \\
\hline
12V Regulator & 12V Fixed LDO* \\
\hline
5V Regulator & 12V Fixed LDO*\\
\hline
3V Regulator & 12V Fixed LDO*\\
\hline
\multicolumn{2}{l}{\small *selected due to constrains caused by silicon shortage.} \\
\end{tabular}
\caption{Component Selection}
\label{table:component_selection}
\end{table}

{\parindent0pt


Details on how the controller microcontroller's software and hardware was developed and interfaced within the scope of the project can be found in  §\ref{sec:} and §\ref{sec:} respectively.

Details on how the receiver microcontroller's software and hardware was developed and interfaced within the scope of the project can be found in  §\ref{sec:} and §\ref{sec:} respectively.

Details on how the ESCs were interfaced with can be found in §\ref{sec:}.

Details on how the L298N was interfaced with can be found in §\ref{sec:}.

Detailed on how the 12V, 5V, and 3V Regulators were interfaced with can be found in §\ref{sec:}.

}

\begin{figure}[H]
\centerline{\includegraphics[width=1.2 \textwidth, angle = 90]{finalised_block_diagram}}
\caption{Final System Block Diagram of ORCA}
\label{fig:finalised_block_diagram}
\end{figure}


\subsubsection{Bill of Materials} 

The bill of materials is listed in Appendix \ref{app:BOM}. Whilst the budget from the University was set at £100, this exceeded that amount. Given that most of the materials for this project had been recycled, the actual budget for the project is less than shown in the bill of materials.

The high cost of this project is due in part to this project being a prototype, and in part to the custom parts that needed to be manufactured for this project. Components are always expected to be more expensive at the prototyping scale of production.

Materials were, for the most part, sourced from responsible VAT registered distributors; which was important when selecting components for mass production. The majority of the components were sourced from Farnell, DigiKey US, CPC, or Ooznest. Some of the other components were sourced from Amazon and eBay. These parts could not be varified to be from a responsible distributor, but these components could have been sourced from other locations if the quantity of the components was larger. 

The fabrication of custom SMD PCBs has been included within the BOM for this project as they were considered to be part of the final prototyped solution. Despite these not being a finalised PCB design for further manufacturing, if applicable, it was a cost that was considered during the prototyping ophase of the project. The PCBs were important in the production of this project as they allowed the secure mounting of the RF modules. Given that all of the components needed mounsting on a structre that would need to be remotely controlled and manauvered, the decision to make PCBs was clear. The PCBs were manufactured in Shenzhen, China but JLC-PCB.

The project was concluded within time scale set but with a slightly expanded budget. Given further time, this project could have been completed closer to the oringial budget. Due to the expensive nature of some of the components used however, the budget of £100 would likely have not been sufficient for this project without significant cuts to functionality and/or goals.
